<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Explore the Spanish INE Data using this Geographic Tool • Siane</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- Google Fonts --><link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&amp;family=Roboto:wght@100;300;400;500;700&amp;display=swap" rel="stylesheet">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><!-- Hugo Universal --><link href="style.violet.css" rel="stylesheet">
<!-- rOpenSpain --><link href="ropenspain.css" rel="stylesheet">
<meta property="og:title" content="Explore the Spanish INE Data using this Geographic Tool">
<meta property="og:description" content="A tool that assists the user in two tasks: the map reading process and the
  data representation process. The reading process is leveraged with functions that allow
  the user to find maps in the Siane repository easily, i.e. searching by map year or
  administrative level. The other main functionality is to bind numerical data to polygons.
  This package is only compatible with the spanish IGN(National Institute of Geography) maps
  and the INE(National Institute of Statistics) data.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed btn-template-main" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
      <span class="sr-only">Toggle navigation</span>
      <i class="fa fa-align-justify"></i>
      </button>
      <span class="navbar-brand" id="ROS-navbar-brand">
      <a class="navbar-link ROS-black" href="index.html"><img src="logo.png" alt="Siane-logo" id="ROS-navbar-logo">Siane</a> <span class="version label label-default hidden-xs" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1</span>
      </span>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="articles/Siane.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
        
      </ul>
</div>  <!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->


      

      </header><div class="row">
  <div class="contents col-md-9" id="home">
<div id="siane" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#siane" class="anchor"></a>Siane</h1></div>
<p>This is an R package to plot maps based on <a href="http://www.ign.es/web/resources/docs/IGNCnig/ANE-SIANE.pdf">CartoSiane</a>, the official Spanis maps provided by the <a href="http://www.ign.es">Instituto Geográfico Nacional</a> (IGN). These maps are compatible with the Spanish <a href="http://www.ine.es/">Instituto Nacional de Estadística</a> (INE) georreferenced data; this makes it simple to combine geographical and statistical data to produce maps.</p>
<p>This document explains how to install the package, how to download the base maps, and, finally, how to produce a number of simple statistical maps.</p>
<div id="package-installation" class="section level2">
<h2 class="hasAnchor">
<a href="#package-installation" class="anchor"></a>Package installation</h2>
<p>To install the package, you need to download Siane maps first.</p>
<div id="obtain-siane-maps" class="section level3">
<h3 class="hasAnchor">
<a href="#obtain-siane-maps" class="anchor"></a>Obtain Siane maps</h3>
<p>The package does not include the map layers. These need to be downloaded from the IGN first from <a href="http://centrodedescargas.cnig.es/CentroDescargas/catalogo.do?Serie=CAANE#selectedSerie">this website</a>.</p>
<p>You need to scroll down to the bottom of the page and click in the highlighted button:</p>
<p><img src="https://raw.githubusercontent.com/rOpenSpain/Siane/master/Images/image_1.png" alt="Image"></p>
<p>You will get into in a new page where you will have to click on <strong>“Buscar por polígono”</strong></p>
<p><img src="https://raw.githubusercontent.com/rOpenSpain/Siane/master/Images/image_2.png" alt="Image"></p>
<p>Once you get here, draw a triangle in the surface of the map. It just has to be a closed polygon. A simple triangle will do it. Then, you need to unlist all the products by clicking on the “+” button.</p>
<p><img src="https://raw.githubusercontent.com/rOpenSpain/Siane/master/Images/image_4.png" alt="Image"></p>
<p>You will need to download the <code>SIANE_CARTO_BASE_S_3M</code> and <code>SIANE_CARTO_BASE_S_6M5</code> maps.</p>
<p><img src="https://raw.githubusercontent.com/rOpenSpain/Siane/master/Images/image_5.png" alt="Image"></p>
<p>You need to unzip the folders in the same directory. <code>Siane</code> should have access to both folders in order to plot the maps. For instance, my folders (<code>SIANE_CARTO_BASE_S_3M</code> and <code>SIANE_CARTO_BASE_S_6M5</code>) are stored at <code>/Users/nunoc/Desktop/siane</code>. You shouldnt’ rename neither the files nor the directories.</p>
</div>
<div id="install-the-package" class="section level3">
<h3 class="hasAnchor">
<a href="#install-the-package" class="anchor"></a>Install the package</h3>
<p>To install, the package, all you need to do is:</p>
<pre><code><a href="https://devtools.r-lib.org/">library(devtools)
install_github("rOpenSpain/Siane")
library(Siane)</a></code></pre>
<p>Then you can use it in your session:</p>
<pre><code><a href="https://rdrr.io/r/base/library.html">library(Siane)</a></code></pre>
<p>However, the package is not usable until you <em>register</em> the maps, i.e., you indicate where to find them.</p>
</div>
<div id="register-and-test-the-package" class="section level3">
<h3 class="hasAnchor">
<a href="#register-and-test-the-package" class="anchor"></a>Register and test the package</h3>
<p>To register the maps, you need to indicate the full path to the directory storing the <code>SIANE_CARTO_BASE_S_3M</code> and <code>SIANE_CARTO_BASE_S_6M5</code> folders. In my case:</p>
<pre><code>obj &lt;- register_siane("/Users/Nuniemsis/Desktop/siane/")</code></pre>
<p>Then you can select the map,</p>
<pre><code>shp &lt;- siane_map(obj = obj, level = "Municipios", canarias = TRUE, peninsula = "close")</code></pre>
<p>and plot it:</p>
<pre><code><a href="https://rdrr.io/pkg/raster/man/plot.html">raster::plot(shp)</a></code></pre>
</div>
</div>
<div id="map-options" class="section level2">
<h2 class="hasAnchor">
<a href="#map-options" class="anchor"></a>Map options</h2>
<p>This section describes some of the parameters to select the map features.</p>
<ul>
<li>
<code>year</code>: Maps change over time and Siane keeps a historic version of them. You can select the year corresponding to the base map. This is particularly useful for municipalities.</li>
<li>
<code>canarias</code>: It indicates whether we want to plot the Canary islands.<br>
</li>
<li>
<code>level</code>: It is the administrative level. For this set of maps there are three: <code>Municipios</code>, <code>Provincias</code> and <code>Comunidades</code>.<br>
</li>
<li>
<code>scale</code>: The scale of the maps. The default scale for municipalities is 1:3000000 <code>scale = "3m"</code>. For provinces and regions the default scale is 1:6500000 <code>scale = "6m"</code>.<br>
</li>
<li>
<code>peninsula</code>: It’s the relative position of the Canarias island to the peninsula in case you want it to be shifted closer to it.</li>
</ul>
<pre><code>shp &lt;- siane_map(obj, level = "Municipios", canarias = TRUE, peninsula = "close")
plot(shp)</code></pre>
</div>
<div id="plotting-ine-data" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-ine-data" class="anchor"></a>Plotting INE data</h2>
<p>One of the advantages of Siane maps is that their entities are indexed using official INE codes. This facilitates the creation of maps representing statistical variables. This section illustrates the procedure. In particular, we will plot the population of the municipalities of <a href="http://www.ine.es/jaxiT3/Tabla.htm?t=2879"><strong>La Rioja</strong></a>.</p>
<div id="data-download" class="section level3">
<h3 class="hasAnchor">
<a href="#data-download" class="anchor"></a>Data download</h3>
<p>To download the data from the INE, you need to click on the button on the right side of the webpage and choose the Pc-Axis format.</p>
<p><img src="https://raw.githubusercontent.com/rOpenSpain/Siane/master/Images/image_6.PNG" alt="Image"></p>
<p>You will need the <code>pxR</code> package to read this file.</p>
<pre><code><a href="https://rdrr.io/r/base/library.html">library(pxR)
library(RColorBrewer)

ine_path &lt;- "/Users/nunoc/Downloads/2879.px"
df &lt;- as.data.frame(read.px(ine_path))

names(df) # List the column names  of the data frame</a></code></pre>
<p>Of course, you will have to provide the path where you have downloaded the <code>2879.px</code> file.</p>
</div>
<div id="data-preparation" class="section level3">
<h3 class="hasAnchor">
<a href="#data-preparation" class="anchor"></a>Data preparation</h3>
<p>First we need to understand the data frame. It has the following columns:</p>
<ul>
<li>
<code>Periodo</code> is the time column in year’s format.<br>
</li>
<li>
<code>value</code> is a column with the numeric value of the population.<br>
</li>
<li>
<code>Sexo</code> is the sex of that population.<br>
</li>
<li>
<code>Municipios</code> is a character array with the municipality name and the municipality code</li>
</ul>
<p>In this dataset there is only one value per territory.</p>
<p>Split the <code>Municipios</code> column to get the municipality’s codes. We are storing the codes in the column <code>codes</code>. This column is really important in order to plot the polygons with the correct colours.</p>
<p>We create a single column in the data frame with those codes.</p>
<pre><code>df$codes &lt;- sapply(df$Municipios, function(x) strsplit(as.character(x), split = " ")[[1]][1])
df$Periodo &lt;- as.numeric(as.character(df$Periodo))</code></pre>
<p>Plotting polygons by colour intensity requires one unique value per territory. Therefore, we have to filter the data frame. Keep this <strong>Golden rule</strong>: One value per territory. In this example I want to plot the total population in the year 2016.</p>
<pre><code>df &lt;- df[df$Sex == "Total" &amp; df$Periodo == 2016, ]</code></pre>
<p>Next, we need to include our population data into the map object, <code>shp</code></p>
<pre><code>by &lt;- "codes"
value &lt;- "value"
level &lt;- "Municipios"

shp_merged &lt;- siane_merge(shp = shp, df = df, by = by, level = level, value = value)</code></pre>
<p>Then, we can plot the map with the <code>plot</code> function. The <code>RColorBrewer</code> package provides lots of colour scales. We can use this colour scales to visualize data over the map. The following function displays all the colour scales from that package. In case we want to plot the population of certain municipalities in a province, we must use a sequential pallete.</p>
<pre><code>pallete_colour &lt;- "OrRd" # Scale of oranges and reds</code></pre>
<p>Let’s say that <code>n</code> is the number of colour intervals.</p>
<pre><code>n &lt;- 5</code></pre>
<p>The brewer.pal function builds a pallete with <code>n</code> intervals and the <code>pallete_colour</code> colour.</p>
<pre><code>values_ine &lt;- shp_merged@data[[value]] # Values we want to plot are stored in the shape@data data frame
colors &lt;- brewer.pal(n, pallete_colour) # A pallete from RColorBrewer
</code></pre>
<p>The style is the distribution of colour within a numerical range. The <code>classIntervals</code> function generates numerical intervals. The upper and lower limits of these intervals are named breaks.</p>
<pre><code>style &lt;- "quantile"
brks &lt;- classIntervals(values_ine, n = n, style = style)
my_pallete &lt;- brks$brks # my_pallete is a vector of breaks</code></pre>
<p>Match each number with its corresponding interval to be able to decide its colour.</p>
<pre><code>col &lt;- colors[findInterval(values_ine, my_pallete,
                           all.inside=TRUE)] # Setting the final colors</code></pre>
<p>Plot the map and set title and legends.</p>
<pre><code><a href="https://rdrr.io/pkg/raster/man/plot.html">raster::plot(shp_merged,col = col) # Plot the map
title_plot &lt;- "Población total por municipios en La Rioja"

title(main = title_plot)
legend(legend = leglabs(round(my_pallete)), fill = colors,x = "bottomright")</a></code></pre>
<p>The resulting map is:</p>
<p><img src="https://raw.githubusercontent.com/rOpenSpain/Siane/master/Images/image_7.png" alt="Image"></p>
</div>
<div id="other-examples" class="section level3">
<h3 class="hasAnchor">
<a href="#other-examples" class="anchor"></a>Other examples</h3>
<p>Let’s try with a different <a href="http://www.ine.es/jaxiT3/Tabla.htm?t=2852&amp;L=0">dataset</a>. This dataset has the spanish population for all the provinces.You can find the link in the README.MD file as well. Now we are going to go deeper in some options.</p>
<pre><code>ine_path &lt;- "/Users/nunoc/Downloads/2852.px"
df &lt;- as.data.frame(read.px(ine_path))
names(df) # List the column names  of the data frame</code></pre>
<div id="data-preparation-1" class="section level4">
<h4 class="hasAnchor">
<a href="#data-preparation-1" class="anchor"></a>Data preparation</h4>
<p>The same steps as before.</p>
<pre><code>df[[by]] &lt;- sapply(df$Provincias,
                   function(x) strsplit(x = as.character(x), split = " ")[[1]][1])</code></pre>
<pre><code>df$Periodo &lt;- as.numeric(as.character(df$Periodo))</code></pre>
<pre><code>
year &lt;- 2016 # year of the maps

df &lt;- df[df$Sex == "Total" &amp; df$Periodo == year,]</code></pre>
<p>The options now will be slightly different:<code>level &lt;- "Provincias"</code>. Remember that first we have to create the shapefile. We can’t use the previous shapefile provided that the level has changed. These maps are provincial maps.</p>
<pre><code>level &lt;- "Provincias"
canarias &lt;- FALSE
scale &lt;- "6m" # "3m" also accepted</code></pre>
</div>
<div id="read-the-map" class="section level4">
<h4 class="hasAnchor">
<a href="#read-the-map" class="anchor"></a>Read the map</h4>
<pre><code>shp &lt;- siane_map(obj = obj, canarias = canarias, year = year, level = level, scale = scale)</code></pre>
<div id="map-options-1" class="section level6">
<h6>Map options</h6>
<p>The values are in the <code>values</code> column and the codes are in the <code>codes</code> column.</p>
<pre><code>value &lt;- "value"
by &lt;- "codes"</code></pre>
<pre><code>
shp_merged &lt;- siane_merge(shp = shp, df = df, by = by, value = value)</code></pre>
</div>
</div>
<div id="plot-the-map" class="section level4">
<h4 class="hasAnchor">
<a href="#plot-the-map" class="anchor"></a>Plot the map.</h4>
<p>```{r, fig.width = 7, fig.height = 7, eval = FALSE} pallete_colour &lt;- “BuPu” n &lt;- 7 style &lt;- “kmeans”</p>
<p>values_ine &lt;- <a href="mailto:shp_merged@data" class="email">shp_merged@data</a>[[value]] # Values we want to plot are stored in the <a href="mailto:shape@data" class="email">shape@data</a> data frame colors &lt;- brewer.pal(n, pallete_colour) # A pallete from RColorBrewer</p>
<p>brks &lt;- classIntervals(values_ine, n = n, style = style) my_pallete &lt;- brks$brks</p>
<p>col &lt;- colors[findInterval(values_ine, my_pallete, all.inside=TRUE)] # Setting the final colors</p>
<p>raster::plot(shp_merged,col = col) # Plot the map</p>
<p>title_plot &lt;- “Población de España a nivel de provincias”</p>
<p>title(main = title_plot) legend(legend = leglabs(round(my_pallete)), fill = colors,x = “bottomright”) ```</p>
<p>This produces the map:</p>
<p><img src="https://raw.githubusercontent.com/rOpenSpain/Siane/master/Images/image_8.png" alt="Image"></p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="http://www.datanalytics.com/">Carlos J. Gil Bellosta</a> <br><small class="roles"> Author </small>  </li>
<li>
<a href="https://github.com/Nuniemsis">Nuno Carvalho</a> <br><small class="roles"> Maintainer, author </small>  </li>
</ul>
</div>

  </div>
</div>

<script>
  var home = document.getElementById("home");
  var banner = document.createElement('div');
  banner.innerHTML = '<a href="https://ropenspain.es/">' +
      '<div id="ROS-heading-breadcrumbs">' +
        '<div class="text-center" id="ROS-partof">' +
          '<p>Part of <img src="ROS-logo.png" alt="ROpenSpain Logo" height="24"> ROpenSpain </p>' +
        '</div></div></a>'

  home.insertBefore(banner,home.firstChild);
</script><footer id="footer"><div class="container">
		<div class="col-md-3 col-sm-6 col-md-offset-1">
			<h4 data-toc-skip>About Siane</h4>
			Developed by <a href="http://www.datanalytics.com/">Carlos J. Gil Bellosta</a>, <a href="https://github.com/Nuniemsis">Nuno Carvalho</a>, part of the <span class="ROS-light">rOpenSpain</span> project.
			<hr class="hidden-md hidden-lg hidden-sm">
</div>
		<div class="col-md-3 col-sm-6 col-md-offset-4">
			<h4 data-toc-skip>About <img src="ROS-logo.png" alt="ROpenSpain Logo" height="24"><span class="ROS-light"> rOpenSpain</span>
</h4>
			<a href="https://ropenspain.es/"><span class="ROS-light">rOpenSpain</span></a> is a community of R enthusiasts whose ultimate goal is to create high-quality R packages for data mining public spanish open sources.
			<hr class="hidden-md hidden-lg hidden-sm">
</div>
	</div>
</footer><div id="copyright">
	<div class="container">
		<div class="col-md-12">
			<p class="pull-left">
			Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.
			</p>
			<p class="pull-right">
			Template by <a href="https://bootstrapious.com/snippets">Bootstrapious </a>.
			Ported to pkgdown by <a href="https://github.com/dieghernan/">dieghernan</a>.
			</p>
		</div>
	</div>
</div>

<!-- ropenspain -->
<script src="ropenspain.js"></script>
</div>
   
  


  </body>
</html>
